<!--
@license
Copyright Â© HatioLab Inc. All rights reserved.
-->

<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../paper-input/paper-input.html">

<dom-module id="things-scene-values">
  <template>
    <style>
      :host {
        @apply(--things-scene-values);
      }

      paper-input {
        @apply(--things-scene-values-input);
      }
    </style>

    <div class="title">[[label]] -variables</div>
    <template is="dom-repeat" items="[[variablesModel]]">
      <paper-input label="[[item.key]]"
                   always-float-label
                   placeholder="[[item.key]]"
                   data-variable$="[[item.key]]"
                   data-type$=[[item.type]]
                   value="[[item.value]]"
                   >
      </paper-input>
    </template>

  </template>

  <script>
    /**
     * `things-scene-values`
     * Polymer component to build form for setting variables automatically.
     * 
     * Example:
     * <things-scene-values 
     *   variables-model="[[variables]]"
     *   values="{{values}}">
     * </things-scene-values>
     * 
     * @customElement
     * @polymer
     * @demo demo/index-values.html
     * @hero hero.svg
     */
    class ThingsSceneValue extends Polymer.Element {

      static get is() { return 'things-scene-values'; }
      
      static get properties() {
        return {
          values: {
            type: Object,
            notify: true
          }
        }
      }

      constructor() {
        super();

        this._boundListener = this._onValueChanged.bind(this);
      }

      connectedCallback() {
        super.connectedCallback();

        this.addEventListener('change', this._boundListener);
      }

      disconnectedCallback() {
        super.disconnectedCallback();

        this.removeEventListener('change', this._boundListener);
      }

      _onValueChanged(e) {
        var input = e.target;

        while (!input.hasAttribute('data-variable') && input !== document.body)
          input = input.parentElement;

        var variable = input.getAttribute('data-variable')
        var type = input.getAttribute('data-type')

        if(typeof(variable) !== 'undefined') {
          var values = {}

          var val = e.target.value

          switch (type) {
            case 'object':
              val = JSON.parse(val)
              break;
            default:

          }

          values[variable] = val

          this.values = values
        }
      }
    }

    window.customElements.define(ThingsSceneValue.is, ThingsSceneValue);
  </script>
</dom-module>
